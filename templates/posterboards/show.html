{% extends "site_base.html" %}
{% block title %}
    {{ posterboard.title }} | Flink
{% endblock %}
{% block extra_head %}
    {{ block.super }}

{% endblock %}
{% block content %}
        {% if blog_owner %}
        <link href="{{ STATIC_URL }}css/editbar.css" type='text/css' rel='stylesheet' />
        <script type="text/javascript" src="{{ STATIC_URL }}js/tiny_mce/tiny_mce.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.corner.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.blockUI.js"></script>
<!--        
	<link href="{{ STATIC_URL }}css/horinaja.css" type='text/css' rel='stylesheet' />
	<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.mousewheel.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.horinaja.js"></script> 
-->
        <script type="text/javascript">
        
            function textareaUpdateMce(id) {
                $('#'+id+'_ifr').contents().find('body').html($('textarea[id="'+id+'"]').val());
                $('textarea[id="'+id+'"]').val($('#'+id+'_ifr').contents().find('body').html());
            }
            
            function mceUpdateTextArea(ed) {
                $('textarea[id="'+ed.id+'"]').val(ed.getBody().innerHTML);
            }
            
            function mcePostChange(ed) {
                var state_id = ed.id.substr(5);
                var element_id = $('div[state-id="'+state_id+'"]').attr('id');
                update_element('#'+element_id);
            }
            
            function showTextArea() {
                $('textarea[type="text"]').show();
            }
            
            function initTinyMCE() {
                tinyMCE.init({
                        // General options
                        theme : "simple",
                        mode : "specific_textareas",
                        editor_selector : "mceEditor",

                        //init_instance_callback : "showTextArea",
                        
                        setup : function(ed) {
                                ed.onKeyUp.add(mceUpdateTextArea);
                                ed.onChange.add(mceUpdateTextArea); 
                                ed.onRedo.add(mceUpdateTextArea); 
                                ed.onUndo.add(mceUpdateTextArea);                                
                                ed.onRemove.add(mcePostChange);
                        }
                });
            }
            
            function destroyTinyMCE() {
                while (tinyMCE.editors.length > 0) { 
                    tinyMCE.activeEditor.remove();
                }
            }
        </script>

        {% endif %}
        <script type="text/javascript">
            var pbid = "#posterboard{{posterboard.id}}";
            var canvas;
            var ctx;
            //var gridArray = [{{gridwidth}}, {{gridheight}}];
            var gridArray = [40,40];
            
            {% if blog_owner %}
            var sidebar_out = false;
            
            // Changing this will break css.
            var sidebartab_id = "#edit_toggle";
            var sidebarcontent_id = "#editbar_contents";
            
            var elementsthatchanged= [];
            var eid = -1;
            
            var selectedelementid = '';
            var validselect = false;
            {% endif %}
            
            $(document).ready(function(){
                
                {% if blog_owner %}
                
                /*
                 * Editbar
                 */
                
                $(sidebartab_id).mousedown(function(){
                   $(sidebartab_id).css('border-style','inset'); 
                });
                $(sidebartab_id).mouseup(function(){
                   $(sidebartab_id).css('border-style','outset'); 
                });
                
                $(sidebartab_id).click(function(){
                    $(sidebarcontent_id).animate({ "width":"toggle"},{duration:400,queue:false});
     
                    if(!sidebar_out){
                        $(sidebartab_id).html($(sidebartab_id).html().replace(/(\.[^.]+)$/, '-active$1'));
                        $( ".element-class" ).draggable( "option", "disabled", false );
                        $( ".element-class" ).resizable( "option", "disabled", false );
                        $( '#edit-status' ).text('Editing Mode');
                        
                        sidebar_out = true;
                        
                        if($('div[type="text"]').length != 0) {
                            $('div[type="text"]').replaceWith(function() {
								return "<textarea " +
                        			"  type='text' "+
                                    "  class='mceEditor child-element-class' "+ 
                                    "  onKeyUp=\"textareaUpdateMce('"+$(this).attr('id')+"');\"" +
                                    "  id='" + $(this).attr('id') +
                                    "' child-id='" + $(this).attr('child-id') +
                                    "' style='width:"+ $(this).parent().width()+"px;height:"+ $(this).parent().height()+"px;'>"+
                                    $('<div>').text($(this).html()).html() +
                                    "</textarea>";
    						});
                            initTinyMCE();
                            $('.mceEditor,.mceLayout').css('width','100%');
                            $('.mceEditor,.mceLayout').css('height','100%');
                            $("span.mceEditor").parent().resizable( "option", "minWidth", 240 );
                            $("span.mceEditor").parent().resizable( "option", "minHeight", 170 );
                        }
                        
                        $(".element-class").each(function(index) {
                            $(this).children(".child-element-class").css('opacity', '0.75');
                            $(this).css('opacity', 1);
                        });
                        
                    }
                    else{
                        $(sidebartab_id).html($(sidebartab_id).html().replace(/-active(\.[^.]+)$/, '$1'));
                        $( ".element-class" ).draggable( "option", "disabled", true );
                        $( ".element-class" ).resizable( "option", "disabled", true );
                        $( '#edit-status' ).text('Viewing Mode');
                        
                        sidebar_out = false;

                        if($('textarea[type="text"]').length != 0) {
    						$('textarea[type="text"]').replaceWith(
    							function() {
                                    return "<div " +
    									"  type='text' "+                                 
    									"  id='" + $(this).attr('id') +
    									"' child-id='" + $(this).attr('child-id') +
                                        "' class='child-element-class "+
    									"' style='width:"+ $(this).parent().width()+"px;height:"+ $(this).parent().height()+"px;'>"+
    									$(this).val() +
    									"</div>";	
    						});
                            destroyTinyMCE();
                        }
                        
                        $(".element-class").each(function(index) {
                            $(this).children(".child-element-class").css('opacity', $(this).attr('opacity'));
                            $(this).css('opacity', 1);
                        });
                    }
                });
                // http://www.kelvinluck.com/assets/jquery/jScrollPane/jScrollPane.html
                // $("#scrollbar_container").jScrollPane();
                
                $('#image_upload').click(function() {
                    jQuery.fn.modalBox("close");
                    jQuery.fn.modalBox({
                        directCall : { element: '#image_upload_form_wrapper' }
                    });
                });
                
                $("#video_upload").click(function() {
                    jQuery.fn.modalBox("close");
                    jQuery.fn.modalBox({
                        directCall : { element: '#video_upload_form_wrapper' }
                    });
                });
                
                $("#audio_upload").click(function() {
                    jQuery.fn.modalBox("close");
                    jQuery.fn.modalBox({
                        directCall : { element: '#audio_upload_form_wrapper' }
                    });
                });
    
                $('#text_upload').click(function() {
                    $('#text_upload_form').submit();
                });
                
                $('#pb_delete').click(function() {
                    var answer = confirm('Are you sure you want to remove it?')
                    if(!answer) { return; }
                    $('#pb_delete_form').submit();
                });
                
                {% endif %}
                
                /*-----------------------
                  Populating elements
                ----------------------- */
                var jsonstring = "{% autoescape off %}{{ element_data }}{%  endautoescape %}";
                jsonstring = jsonstring.replace(/'/g,'"');
                var elementsToAdd = JSON.parse(jsonstring);
                
                var elementstyles =  'display:block;position=absolute;';
                {% if blog_owner %}
                    elementstyles += 'cursor:pointer;'
                {% endif %}
                
                var element, state, states, typestate, linkedpb, statestring, domstring;
                $.each(elementsToAdd, function(index, elementdata) {
                    element = elementdata[0];
                    typestate = elementdata[1];
                    states = elementdata[2];
                    if(elementdata.length > 3) {
                        linkedpb = elementdata[3];
                    }
                    else {
                        linkedpb = null;
                    }
                    
                    if(element.fields.type == 'image') {
                        domstring = "<div id='element" + element.pk + "'" +
                                    " element-type='image'"+
                                    " style='" + elementstyles +
                                    "' class='element-class " +
                                    {% if blog_owner %}
                                    " ui-state-disabled " +
                                    {% endif %}
                                    "'>";
                                    if(linkedpb != null) {
                                        domstring += "<a href='/people/{{blogger.username}}/posterboards/"+linkedpb.fields.title_path+"'>";
                                    }
                                    domstring +=
                                    "<img id='state-1" + 
                                    "' child-id='" + typestate.pk + 
                                    "' src='{{ MEDIA_URL }}"+ typestate.fields.image +
                                    "' style='width:100%;height:100%;"+
                                    "' alt='"+ typestate.fields.alt +
                                    "' class='child-element-class " +
                                    "'>";
                                    if(linkedpb != null) {
                                        domstring += "</a>";
                                    }
                                    domstring += "</div>";
                    }
                    else if(element.fields.type == 'video') {
                        domstring = "<div id='element" + element.pk + "'" +
                                    " style='" + elementstyles +
                                    "' class='element-class " +
                                    {% if blog_owner %}
                                    " ui-state-disabled " +
                                    {% endif %}
                                    "' element-type='video'>"+
                                    "<video id='state-1" + 
                                    "' child-id='" + typestate.pk + 
                                    "' class='child-element-class "+
                                    "'  preload='auto' controls='video_controls"+element.pk+"'>";
                                    if(typestate.fields.ogv_video != "") {
                                        domstring +=
                                        "<source src='"+ {{MEDIA_URL}} + typestate.fields.ogv_video +
                                        "' type='video/ogg'>";
                                    }
                                    if(typestate.fields.mp4_video != "") {
                                        domstring +=
                                        "<source src='"+ {{MEDIA_URL}} + typestate.fields.mp4_video +
                                        "' type='video/mp4'>";
                                    }
                                    if(typestate.fields.original_video != "") {
                                        domstring +=
                                        "<source src='"+ {{MEDIA_URL}} + typestate.fields.original_video +
                                        "'>";
                                    }
                                        domstring +=
                                        "Your browser does not support the <code>video</code> element."+
                                    "</video>"+
                                    "</div>";
                    }
                    else if(element.fields.type == 'audio') {
                        domstring = "<div id='element" + element.pk + "'"+
                                    " style='" + elementstyles +
                                    "' class='element-class " +
                                    {% if blog_owner %}
                                    " ui-state-disabled " +
                                    {% endif %}
                                    "' element-type='audio'>"+
                                    "<audio id='state-1" + 
                                    "' child-id='" + typestate.pk +
                                    "' class='child-element-class "+
                                    "' preload='auto' controls='audio_controls"+element.pk+"'>";
                                    if(typestate.fields.original_audio != "") {
                                        domstring +=
                                        "<source src='"+ {{MEDIA_URL}} + typestate.fields.original_audio +
                                        "'>";
                                    }
                                        domstring +=
                                        "Your browser does not support the <code>audio</code> element."+
                                    "</audio>"+
                                    "</div>";
                    }
                    else if(element.fields.type == 'text') {
                        var domtext =   "<div " +
                        			"  type='text"+
                                    "' child-id='" + typestate.pk +
                                    "' class='child-element-class "+
                                    "' style='width:100%;height:100%;'>"+
                                    $('<div>').html(typestate.fields.content).text() +
                                    "</div>";
                        
                        domstring = "<div id='element" + element.pk + "'" +
                                       " element-type='text'"+
                                       " class='element-class' " +                                       
                                       " style='" + elementstyles +
                                        "'>"+domtext+"</div>";
                    }

                    $(pbid).append(domstring);
                    
                    {% if blog_owner %}
                    make_element_interactive("#element"+ element.pk);
                    {% endif %}
                    
                    // For audio, set the height and width.
                    if(element.fields.type == 'audio') {
                        $("#element" + element.pk +" audio").css('height', parseInt($("#element" + element.pk).css('height')));
                        $("#element" + element.pk +" audio").css('width', parseInt($("#element" + element.pk).css('width')));
                    }
                    
                    
                    // All elements need to be position: absolute.
                    $("#element"+ element.pk).css("position","absolute");
                    
                    // Populate states and set event handlers if not in editing mode.
                    // If in editing mode, populate first state for all elements instead.
                    $.each(states, function(index, state){
                        statestring = "<state id='stateinfo"+ state.pk +
                                      "' opacity='"+ state.fields.opacity +
                                      "' state-id='" + state.pk +
                                      "' delay='" + state.fields.delay +
                                      "' speed='" + state.fields.speed +
                                      "' style='" +
                                      " left:"+ (state.fields.position_x * gridArray[0]) + ";"+
                                      " top:"+ (state.fields.position_y * gridArray[1]) + ";"+
                                      " width:" + (state.fields.position_width * gridArray[0]) +";"+
                                      " height:" + (state.fields.position_height * gridArray[1]) +";"+
                                      " display:none;"+
                                      "'></state>";
                        $("#element"+element.pk).append(statestring);
                    });
                    state = elementdata[2][0]; // First state.
                    
                    // Update element with state info.
                    switch_element_to_state("#element"+element.pk, "#stateinfo"+ state.pk)
                    
                    /*
                     // Set opacity of all elements if anyone but the blog owner is viewing it
                     {% if not blog_owner %}
                     $("#element"+element.pk).css('opacity', state.fields.opacity);
                     {% endif %}                   
                     * Element Attr:
                     " opacity='"+ state.fields.opacity +"'"+
                     " state-id='" + state.pk + "'" +
                     * Element Styles:                                        
                     " left:"+ (state.fields.position_x * gridArray[0]) + ";"+
                     " top:"+ (state.fields.position_y * gridArray[1]) + ";"+
                     " width:" + (state.fields.position_width * gridArray[0]) +";"+
                     " height:" + (state.fields.position_height * gridArray[1]) +";"+
                     * Child Element Attr:
                     "  id='state" + state.pk +
                     * Video Element Styles:
                     "' height='"+ state.fields.position_height * gridArray[1] +
                     "' width='"+ state.fields.position_width * gridArray[0] +
                    */
                });
                
                {% if blog_owner %}
                /*-----------------------
                  Changing elements
                ----------------------- */
                $('#timeline-editor').mousedown(function(){
                    validselect = true;
                });
               
                var blockmap = {
                    message: '<h2>Please select an element to edit its properties.</h2>',
                    css: { 
                          border: '5px solid #a00',
                          width: '70%',
                         }
                };
               
                $(document).mousedown(function(){
                    if(!sidebar_out) { return; }
                    if(!validselect) {
                        if(selectedelementid != "") {
                            $('#'+selectedelementid).removeClass('selected-element');
                        }
                        selectedelementid = '';
                        if($("#timeline-editor").children(".blockUI").length <= 0) {
                            $("#timeline-editor").block(blockmap);
                        }
                    }
                    validselect = false; 
               });
               
               $(document).keydown(function(event) {
                    // Shift + DEL
                    if (event.shiftKey && event.keyCode == 46 && selectedelementid != '') {
                        var answer = confirm('Are you sure you want to remove the element?')
                        if(!answer) { return; }
                        $.ajax({
                            url: '/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/'+selectedelementid.substr(7)+'.json',
                            data: {
                                'csrfmiddlewaretoken': '{{csrf_token}}',
                                '_action': 'delete'
                            },
                            method: 'get',
                            success: function() {$('#'+selectedelementid).remove(); },
                        });
                    } 
                });
               
                $("#save-changes").click(function(){
                    // Assumes eid is set to some value.
                    if(eid == -1) {
                        return;
                    }
                    
                    $.ajax({
                       url: '/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/'+eid+'.json',
                       dataType: 'json',
                       data: {
                           'opacity': 1,
                           'position_width': $("#element"+eid).width(),
                           'position_height': $("#element"+eid).height(),
                       }                        
                    });
                    
                    eid = -1;
                });
                
                $("#toggle-editing-help").click(function() {
                    $("#editing-help").toggle('fast',function(){
                        // Nothing much to do here.
                    });
                })
                
                /*-----------------------
                        Timeline
                ----------------------- */
               
                $("#timeline-slider").slider({
                    value:1,
                    min: 1,
                    max: 1,
                    step: 1,
                    slide: function( event, ui ) {
                        $("#timeline-step-label").text(ui.value);
                    }
                });
                $("#opacity-slider").slider({
                    orientation: "vertical",
                    value: 100,
                    range: 'min',
                    min: 0,
                    max: 100,
                    slide: function(event, ui) {
                        if(selectedelementid != null) {
                            $("#"+selectedelementid).children(".child-element-class").css('opacity', ui.value/100);
                            $("#"+selectedelementid).attr('opacity', ui.value/100);
                        }
                    },
                    change: function(event, ui) {
                        if(selectedelementid != null) {
                            $("#"+selectedelementid).children(".child-element-class").css('opacity', 0.75);
                            $("#"+selectedelementid).attr('opacity', ui.value/100);
                            update_element("#"+selectedelementid);
                        }
                    }
                });

                $("#state-description").corner();
                $("#state-properties").corner();
                $("#timeline-editor").corner();
                
                $(sidebartab_id).click();
                $("#timeline-editor").block(blockmap);
                
                {% endif %}

            });
            
            function switch_element_to_state(eselector, sselector) {
                $(eselector).attr('opacity', $(sselector).attr('opacity'));
                $(eselector).attr('state-id', $(sselector).attr('state-id'));
                $(eselector).css('height', $(sselector).css('height'));
                $(eselector).css('width', $(sselector).css('width'));
                $(eselector).css('left', $(sselector).css('left'));
                $(eselector).css('top', $(sselector).css('top'));
                {% if not blog_owner %}
                $(eselector).css('opacity', $(sselector).attr('opacity'));
                {% endif %} 
                $(eselector).children('.child-element-class').attr('id', "state"+$(sselector).attr('state-id'));
                $(eselector).children('video').css('height', $(sselector).css('height'));
                $(eselector).children('video').css('width', $(sselector).css('width'));
            }
            
            {% if blog_owner %}

            function set_timeline_info(obj) {
                $("#state-description #element-type").text($(obj).attr("element-type"));
                $("#state-description #number-of-states").text($(obj).children("state").length);
                var step = state_position(obj, $(obj).attr("state-id"));
                $("#state-description #timeline-step-label").text(step);
                $("#timeline-slider").slider( "option", "value", step);
                $("#timeline-slider").slider( "option", "max", $("#state-description #number-of-states").text());
                $("#opacity-slider").slider("option", "value", $(obj).attr("opacity")*100);
            }
            
            // State id is a number.
            function state_position(elementobj, stateid) {
                var pos = 0;
                $(elementobj).children("state").each(function(index) {
                    if($(this).attr('state-id') == stateid) {
                        pos = index + 1;
                    }
                });
                return pos;
            }
                                 
            function make_element_interactive(selector) {
               $(selector).draggable({ 
                    containment: pbid, 
                    disabled: false,
                    scroll: false,
                    grid: gridArray,
                    stack: pbid +" div,img,text,video,audio",
                    stop: function(event, ui) { update_element("#"+$(this).attr('id')); },
                });
                $(selector).resizable({
                    grid: gridArray,
                    containment: pbid,
                    disabled: false,
                    stop: function(event, ui) {
                        var selector = "#"+$(this).attr('id'); 
                        // If there are video elements here, alter their width/height too.
                        if($(selector +" video").length != 0) {
                           // Only 1 element anyway.
                           $(selector +" video").attr('height', parseInt($(this).css('height')));
                           $(selector +" video").attr('width', parseInt($(this).css('width')));
                        }
                        else if($(selector +" audio").length != 0) {
                           $(selector +" audio").css('height', parseInt($(this).css('height')));
                           $(selector +" audio").css('width', parseInt($(this).css('width')));
                        }
                        /*else if($(selector +" .mceEditor").length != 0) {
                            console.log("setting height to "+parseInt($(this).css('height')));
                            console.log("setting width to "+parseInt($(this).css('width')));
                            $(selector +" .mceEditor").css('height', parseInt($(this).css('height')));
                            $(selector +" .mceEditor").css('width', parseInt($(this).css('width')));
                        }*/
                        update_element(selector); 
                    },
                    //animate: true,
                });
                
                $(selector).mousedown(function(){
                    if(!sidebar_out) { return; }
                    
                    var subselector;
                                    
                    // If element with id exists and is not the element selected, change the class.
                    if(selectedelementid != $(this).attr('id') && selectedelementid != "") {
                        subselector = '#' + selectedelementid;
                        /*if($(subselector).attr("element-type") == 'audio') {
                            subselector += ' audio';
                        }*/
                        $(subselector).removeClass('selected-element');
                    }
                    
                    subselector = '#' + $(this).attr('id');
                    /*if($(subselector).attr("element-type") == 'audio') {
                        subselector += ' audio';
                    }*/
                    $(subselector).addClass('selected-element');
                    
                    validselect = true;
                    selectedelementid = $(this).attr('id');

                    // Timeline                    
                    set_timeline_info(this);
                    $("#timeline-editor").unblock();
                });
                    
                if($(selector).attr('element-type') == 'text') {  
                    $(selector).focusout(function(){
                        if ($(selector).draggable("option","disabled") == false) {
                            update_element(selector);
                        }
                    });
                }
            }
                
            function update_element(selector) 
                {
                    // Populate Appropriate Fields
                    var elementData = {};
                    elementData['csrfmiddlewaretoken'] = '{{csrf_token}}';
                    elementData['_action']='put';
                    elementData['element-type']=$(selector).attr('element-type');
                    elementData['element-id']=parseInt(selector.substr(8));
                    elementData['state-id']=$(selector).attr('state-id');
                    elementData['state-position_width']=parseInt($(selector).width() / gridArray[0]);
                    elementData['state-position_height']=parseInt($(selector).height() / gridArray[1]);
                    elementData['state-position_x']=parseInt(($(selector).position().left) / gridArray[0]);
                    elementData['state-position_y']=parseInt(($(selector).position().top) / gridArray[1]);
                    elementData['state-opacity']=parseFloat($(selector).attr('opacity'));
                    
                    var child = $('#state'+$(selector).attr('state-id')); 
                    if ($(selector).attr('element-type') == 'image') 
                    {
                        elementData['image-alt'] = child.attr('alt');
                    }
                    else if ($(selector).attr('element-type') == 'text')
                    {
                        elementData['text-content'] = child.val();
                        if (child.val().length == 0 && child.html().length !=0) 
                        {
                            elementData['text-content'] = child.html();
                        }
                    }
                    elementData['child-id']=child.attr('child-id');
                    
                    $.ajax({
                       url: '/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/'+selector.substr(8)+'.json',
                       data: elementData,
                       dataType: 'json',
                       success: function() { $(selector).effect("highlight", {}, 1000); },
                       type: 'post',
                    });
                }
            {% endif %}
        </script>
    <div id='content'>
       {% block editbar %}
       {% if blog_owner %}
       <div id="editbar">
           <a href="javascript:void(0);" id="edit_toggle"><span id="edit_toggle_text">Edit Bar</span></a>
           <div id="editbar_contents" style="display: none">
               <div id="editbar_contents_inner">
                   <div id="scrollbar_container">
                       <div id="scrollbar_content">
                           <button id="image_upload">Add Image</button>
                           <button id="text_upload">Add Text</button>
                           <button id="video_upload">Add Video</button>
                           <button id="audio_upload">Add Audio</button>
                           <button id="pb_delete">Remove Posterboard</button>
                           <!--<button id="save-changes">Save Changes to Posterboard</button>-->
                       </div>
                   </div>
               </div>
           </div>
       </div>
       <div style="display:none" id="image_upload_form_wrapper">
           <form action='/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/' id="image_upload_form" name="image_upload_form" method="post"
            enctype="multipart/form-data">
               <div class="form-submit-errors"></div>
               {% csrf_token %}
               <input type="hidden" name="element-type" value="image">
               Image: <input type="file" id="upload-image-field" name="image"><br>
               <input type="submit" id="image_upload_button" value="Upload Image">
           </form>
       </div>
       <div style="display:none" id="video_upload_form_wrapper">
           <p class="editing-mode-info" style="display:block;">
               Please be aware that your media will not appear on your posterboard
               for up to <strong>three minutes</strong>, to allow time for any re-encoding necessary
               to finish. Your media will appear after that, whether or not the encoding
               was successful. Please do not attempt to re-upload your media, as it will result
               in unnecessary duplicate files. The maximum file size is 50MB.
           </p>
           <p class="editing-mode-info" style="display:block;">
               Please upload your video in the <strong><code>ogv</code></strong> format. If you upload an 
               <strong><code>avi</code></strong>/<strong><code>mpeg</code></strong> video, we will try our best to convert 
               it successfully, but this isn't guaranteed. Utilities to
               convert your video to <strong><code>ogv</code></strong> are 
               <a href="http://video.online-convert.com/convert-to-ogg" target="_blank">
                   available on the web
               </a>.
           </p>
           <form action='/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/' id="video_upload_form" name="video_upload_form" method="post"
            enctype="multipart/form-data">
               <div class="form-submit-errors"></div>
               {% csrf_token %}
               <input type="hidden" name="element-type" value="video">
               Video: <input type="file" id="upload-video-field" name="video"><br>
               <input type="submit" id="video_upload_button" value="Upload Video">
           </form> 
       </div>
       <div style="display:none" id="audio_upload_form_wrapper">
           <p class="editing-mode-info" style="display:block;">
               Please be aware that your media will not appear on your posterboard
               for up to <strong>three minutes</strong>, to allow time for any re-encoding necessary
               to finish. Your media will appear after that, whether or not the encoding
               was successful. Please do not attempt to re-upload your media, as it will result
               in unnecessary duplicate files. The maximum file size is 50MB.
           </p>
           <p class="editing-mode-info" style="display:block;">
               Please upload your audio in the <strong><code>ogg</code></strong>/<strong><code>wav</code></strong> formats.
               Audio files in other popular formats are not guaranteed to play correctly.
               Utilities to convert your audio are 
               <a href="http://www.oggconvert.com/" target="_blank">
                   available on the web
               </a>.
           </p>
           <form action='/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/' id="audio_upload_form" name="audio_upload_form" method="post"
            enctype="multipart/form-data">
               <div class="form-submit-errors"></div>
               {% csrf_token %}
               <input type="hidden" name="element-type" value="audio">
               Audio: <input type="file" id="upload-audio-field" name="audio"><br>
               <input type="submit" id="audio_upload_button" value="Upload audio">
           </form>
       </div>
       <div style="display:none" id="text_upload_form_wrapper">
           <form action='/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/elements/' id="text_upload_form" name="text_upload_form" method="post"
            enctype="multipart/form-data">
               <div class="form-submit-errors"></div>
               {% csrf_token %}
               <input type="hidden" name="element-type" value="text">
               <textarea name='text-content'>Enter Text Here.</textarea>
               <input type="submit" id="text_upload_button" value="Upload Text">
           </form>
       </div>
      <div style="display:none" id="pb_delete_form_wrapper">
           <form action='/people/{{blogger.username}}/posterboards/{{posterboard.title_path}}/' id="pb_delete_form" name="pb_delete_form" method="get">
               <div class="form-submit-errors"></div>
               {% csrf_token %}
               <input type="hidden" name="_action" value="delete">
               <input type="submit" id="pb_delete_button" value="Delete Posterboard">
           </form>
       </div>
       {% endif %}

      {% if blog_owner %}
      <p align='center' style="text-align:center" id="edit-status">Viewing Mode</p>
      {% if converting %}
      <p align='center' style='text-align:center' id='converting-info'>
          <small>
          <img src='{{ STATIC_URL }}images/jquery-modalbox-1.2.0/ajax-loader.gif' style='height: 2em;vertical-align:middle'> 
          Converting uploaded media. The page will reload with updated information in a minute.
          </small>
      </p>
      <script type="text/javascript">
          setTimeout(function() {
                window.location.reload();
          },60000);
      </script>
      {% endif %}
      {% if not linked %}
         <div class="link-posterboard-info" style="display:block;">
            Hey there. We notice this posterboard isn't yet linked from your 
            <a href="/people/{{blogger.username}}">home page</a>. Don't forget!
         </div>
      {% endif %}
      <p align='center' class="editing-mode-info" style="display:block;">
          Use left sidebar to switch modes.The elements <strong>cannot</strong> be edited while in <strong>Viewing Mode</strong>.<br>
          This is to prevent accidental editing. Elements appear lighter in editing mode.
      </p>
      
      <div class="editing-mode-info" style="display:block;">
          <a href="javascript:" id="toggle-editing-help">Help</a>
      </div>
      <div id='editing-help' class='editing-mode-help'>
          <div>
               Select an element by clicking on it. All changes to elements will be saved automatically.
               <ul>
                   <li><strong>Resize: </strong>
                        Elements that are resizeable, such as images and video, can be resized using the bottom and right edges,
                        as well as the bottom-left corner.
                   </li>
                   <li><strong>Drag-and-drop: </strong>
                       Elements can be dragged and dropped about the posterboard.
                   </li>
                   <li><strong>Stack: </strong>
                       Elements are stackable. You can intuitively drag an element out from underneath another element
                       and place it on top and the stacking will work as expected.
                   </li>
                   <li><strong>Delete: </strong>
                       You can delete an element by hitting the Shift + Delete key after you select it.
                   </li>
                   <li><strong>Opacity: </strong>
                       Opacity is always 0.75 in editing mode. However, you can preview the actual opacity 
                       by viewing the object in Viewing Mode.
                   </li>
                   <li><strong>Timeline: </strong>
                       An element's timeline can be modified in Editing Mode.
                   </li>
               </ul>
          </div>
      </div>
      {% endif %}
      <div id="timeline-editor" class="timeline-editor">
          <div id="state-description" class="state-boxes timeline-editor">
                <h3 style="text-align:center;margin:0"><span id="element-type"></span></h3>
              <p>
                Number of States: <span id="number-of-states">1</span><br>
                State: <span id="timeline-step-label">1</span><br>
              </p>
          </div>
          <div id="state-properties" class="state-boxes timeline-editor">
              
              <div id="opacity-slider"></div>
              <span id="opacity-slider-label">Opacity</span>
          </div>
          <div id="timeline-slider"></div>
      </div>
      {% endblock %}
      <br>
      <div id="posterboard{{posterboard.id}}" class='grid pbgrid'>
	<!-- 
	     There shouldn't be any hardcoded elements here.
	     All elements must be carefully added via jQuery and kept track of.
	     When an element is added or removed, their unique, randomly generated IDs
	     must be stored in javascript and regularly transmitted to the server
	     in an attempt to 'save' the current state of the elements.
	     All elements must be draggable, resizeable and extend properties that make
	     them editable.
	  --> 
      </div>      
      <div style="display:none" id="hidden-store">
      </div>
    </div>
{% endblock %}
